"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const url_1 = require("url");
const getSrcsetUrls = (srcset) => {
    if (!srcset) {
        return [];
    }
    const parts = srcset.split(',');
    const urls = parts.reduce((total, part) => {
        const url = part.trim().split(' ')[0];
        if (!url) {
            return total;
        }
        total.push(url.trim());
        return total;
    }, []);
    return urls;
};
exports.getElementByUrl = (dom, url) => {
    const elements = dom.querySelectorAll('[href],[src],[poster],[srcset]').filter((element) => {
        const elementUrl = element.getAttribute('href') || element.getAttribute('src') || element.getAttribute('poster');
        const elementUrls = [elementUrl, ...getSrcsetUrls(element.getAttribute('srcset'))];
        if (elementUrls.includes(url)) {
            return true;
        }
        const absoluteUrls = elementUrls.map((relativeUrl) => {
            try {
                const { href } = new url_1.URL(relativeUrl, dom.base);
                return href;
            }
            catch (e) {
                return 'invalid';
            }
        });
        if (absoluteUrls.includes(url)) {
            return true;
        }
        return false;
    });
    if (elements.length > 0) {
        return elements[0];
    }
    return null;
};
